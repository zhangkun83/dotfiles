#!/bin/bash
DIR="$HOME/orgwork"
BACKUP_DIR="rsync://localhost:1873/x20/users/zh/zhangkun/orgwork"

if [[ "$1" != "upload" ]]; then
    echo "Updating local files ..."
    rsync -rtuv "$BACKUP_DIR/" "$DIR" || exit 1

    echo "Press Enter to open orgwork"
    read

    cd $DIR
    # Disable create-lockfiles because it doesn't work well with Google Drive
    emacs --eval="(progn \
                (setq org-agenda-files '(\"$DIR\")\
                      frame-title-format \"orgwork\" )\
                (add-to-list 'zk-remote-file-prefix-list \"$DIR\")
                (zk-orgwork-goto-latest-note-file)
                (end-of-buffer))"
fi

echo "Uploading changed files ..."
rsync -rtuv "$DIR/" "$BACKUP_DIR" || exit 1
